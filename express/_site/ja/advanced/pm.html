<!DOCTYPE html>
<!---
 Copyright (c) 2016 StrongLoop, IBM, and Express Contributors
 License: MIT
-->

<html lang="ja" prefix="og: http://ogp.me/ns#">

  <head>
    <title>Express アプリケーション用のプロセス・マネージャー</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="og:image" content="https://expressjs.com/images/express-facebook-share.png">
    <link rel="icon" type="image/png" href="/images/favicon.png" />
    <link rel="stylesheet" href="/css/style.css?_=1652552968">
    <link rel="stylesheet" href="/css/dropit.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
    <link rel="stylesheet" href="/css/ja.css">
    <link rel="stylesheet" href="/css/nodeinteractive.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script data-cfasync="false" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script data-cfasync="false" src="/js/ismobile.js"></script>
    <script data-cfasync="false" src="/js/app.js"></script>
    <script data-cfasync="false" src="/js/retina.js"></script>
    <script data-cfasync="false" src="/js/dropit.js"></script>
    <script data-cfasync="false" src="/js/prism.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

</head>


  
  <body class="non-en-doc">
  

    <section class="page content">

      <header>
  <div id="blm-banner">
    Black Lives Matter. <br>
    <a id="blm-donate"  href="https://support.eji.org/give/153413/#!/donation/checkout">Support the Equal Justice Initiative</a>.
  </div>
  <div id="mobile-menu">
      <div id="nav-button" class="fa fa-bars fa-2x button"></div>
  </div>
  <section id="logo"><a href="/" class="express">Express</a>
  </section>
  <div id="navbar">
      <input id="q" placeholder="🔎 search">
      <ul id="navmenu">
          <li><a href="/ja/" id="home-menu">ホーム</a></li>
          <li>
              <ul id="getting-started-menu" class="menu">
                  <li><a href="/ja/starter/installing.html">概説</a>
                      <ul>
                          <li>
                            <a href="/ja/starter/installing.html">
                              インストール
                            </a>
                          </li>
                          <li>
                            <a href="/ja/starter/hello-world.html">
                              Hello World
                            </a>
                          </li>
                          <li>
                          <a href="/ja/starter/generator.html">
                            Express ジェネレーター
                          </a>
                          </li>
                          <li>
                            <a href="/ja/starter/basic-routing.html">
                              基本的なルーティング
                            </a>
                          </li>
                          <li>
                            <a href="/ja/starter/static-files.html">
                              静的ファイル
                            </a>
                          </li>
                          <li>
                            <a href="/ja/starter/faq.html">
                              FAQ
                            </a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="guide-menu" class="menu">
                  <li><a href="/ja/guide/routing.html">ガイド</a>
                      <ul>
                          <li><a href="/ja/guide/routing.html">ルーティング</a>
                          </li>
                          <li><a href="/ja/guide/writing-middleware.html">ミドルウェアの作成</a>
                          </li>
                          <li><a href="/ja/guide/using-middleware.html">ミドルウェアの使用</a>
                          </li>
                          <li><a href="/ja/guide/using-template-engines.html">テンプレート・エンジンの使用</a>
                          </li>
                          <li><a href="/ja/guide/error-handling.html">エラー処理</a>
                          </li>
                          <li><a href="/ja/guide/debugging.html">デバッグ</a>
                          </li>
                          <li><a href="/ja/guide/behind-proxies.html">プロキシーの背後の Express</a>
                          </li>
                          <li><a href="/ja/guide/migrating-4.html">Express 4 への移行</a>
                          </li>
                          <li><a href="/ja/guide/migrating-5.html">Express 5 への移行</a>
                          </li>
                          <li><a href="/ja/guide/database-integration.html">データベースの統合</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="application-menu" class="menu">
                  <li><a href="/ja/4x/api.html">API リファレンス</a>
                      <ul>
                          <li><a href="/ja/4x/api.html">4.x</a>
                          </li>
                          <li><a href="/ja/3x/api.html">3.x (非推奨)</a>
                          </li>
                          <li><a href="/2x/">2.x (非推奨)</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="advanced-topics-menu" class="menu">
                  <li><a href="/ja/advanced/developing-template-engines.html" class="active">高度なトピック</a>
                      <ul>
                          <li><a href="/ja/advanced/developing-template-engines.html">テンプレート・エンジン</a>
                          </li>
                          <li><a href="/ja/advanced/pm.html">プロセス・マネージャーの使用</a>
                          </li>
                          <li><a href="/ja/advanced/security-updates.html">セキュリティー更新</a>
                          </li>
                          <li><a href="/ja/advanced/best-practice-security.html">セキュリティーに関するベスト・プラクティス</a>
                          </li>
                          <li><a href="/ja/advanced/best-practice-performance.html">パフォーマンスに関するベスト・プラクティス</a>
                          </li>

                      </ul>
                  </li>
              </ul>
          </li>
          <li>
              <ul id="resources-menu" class="menu">
                  <li><a href="/ja/resources/glossary.html">リソース</a>
                      <ul>
                          <li><a href="/ja/resources/glossary.html">用語集</a>
                          </li>
                          <li><a href="/ja/resources/middleware.html">ミドルウェア</a>
                          </li>
                          <li><a href="/ja/resources/community.html">コミュニティー</a>
                          </li>
                          <li><a href="/ja/resources/learning.html">追加学習</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
      </ul>
  </div><!--<a href="http://strongloop.com/node-js/training/" title="StrongLoop が提供する Node と Express に関する研修" id="strongloop-header">StrongLoop が提供する Express と Node.js に関する研修</a>-->
</header>


      <div id="overlay"></div>

      
        <div id="i18n-notice-box" class="doc-box doc-warn">
          <p><p><a href="http://strongloop.com">StrongLoop / IBM</a>によって提供されるこの翻訳.</p>

本書は、英語の資料と比較すると古くなっている可能性があります。最新の更新については、<a href="/">英語版の資料</a>を参照してください。
</p>
<div id="close-i18n-notice-box" title="Close">✖</div>

        </div>
      
      <div id="page-doc" markdown="1">
<h1 id="express-">Express アプリケーション用のプロセス・マネージャー</h1>

<p>Express アプリケーションを実動で実行する際、以下のタスクを実行するために<em>プロセス・マネージャー</em> を使用すると便利です。</p>

<ul>
  <li>アプリケーションが異常終了した場合に自動的に再始動する。</li>
  <li>ランタイム・パフォーマンスとリソース使用量に関するインサイトを得る。</li>
  <li>パフォーマンスを向上させるために設定を動的に変更する。</li>
  <li>クラスタリングを制御する。</li>
</ul>

<p>プロセス・マネージャーは、アプリケーション・サーバーに似ていて、デプロイメントを容易に行えるようにして、高可用性を実現し、アプリケーションを実行時に管理できるようにする、アプリケーションの「コンテナー」です。</p>

<p>Express およびその他の Node.js アプリケーション用の最も一般的なプロセス・マネージャーは次のとおりです。</p>

<ul>
  <li><a href="#forever">Forever</a></li>
  <li><a href="#pm2">PM2</a></li>
  <li><a href="#strongloop-process-manager">StrongLoop Process Manager</a></li>
  <li><a href="#systemd">SystemD</a></li>
</ul>

<p>上記の 4 つのツールのいずれを使用しても非常に役立ちますが、StrongLoop Process Manager は、Node.js アプリケーションのライフサイクル全体に対応した包括的な実行時とデプロイメントのソリューションを提供する唯一のツールであり、実動前と実動後のすべてのステップに関するツールを統合インターフェースで提供します。</p>

<p>以下に、これらの各ツールについて簡単に説明します。
詳細な比較については、<a href="http://strong-pm.io/compare/">http://strong-pm.io/compare/</a> を参照してください。</p>

<h2 id="forever">Forever</h2>

<p>Forever は、特定のスクリプトが確実に継続的 (永続的) に実行されるようにするための単純なコマンド・ライン・インターフェース・ツールです。Forever のインターフェースは単純であるため、Node.js アプリケーションおよびスクリプトの小規模なデプロイメントを実行するのに理想的です。</p>

<p>詳細については、<a href="https://github.com/foreverjs/forever">https://github.com/foreverjs/forever</a> を参照してください。</p>

<h3 id="section">インストール</h3>

<pre><code class="language-console">$ [sudo] npm install forever -g
</code></pre>

<h3 id="section-1">基本的な使用法</h3>

<p>スクリプトを開始するには、次のように <code>forever start</code> コマンドを使用して、スクリプトのパスを指定します。</p>

<pre><code class="language-console">$ forever start script.js
</code></pre>

<p>このコマンドは、スクリプトをデーモン・モード (バックグラウンド) で実行します。</p>

<p>端末に接続されるようにスクリプトを実行するには、次のように <code>start</code> を省略します。</p>

<pre><code class="language-console">$ forever script.js
</code></pre>

<p>次の例に示すように、ロギング・オプション <code>-l</code>、<code>-o</code>、および <code>-e</code> を使用して Forever ツールおよびスクリプトの出力をログに記録することをお勧めします。</p>

<pre><code class="language-console">$ forever start -l forever.log -o out.log -e err.log script.js
</code></pre>

<p>Forever によって開始されたスクリプトのリストを表示するには、次のようにします。</p>

<pre><code class="language-console">$ forever list
</code></pre>

<p>Forever によって開始されたスクリプトを停止するには、<code>forever stop</code> コマンドを使用して、プロセス索引 (<code>forever list</code> コマンドによってリストされます) を指定します。</p>

<pre><code class="language-console">$ forever stop 1
</code></pre>

<p>あるいは、次のようにファイルのパスを指定します。</p>

<pre><code class="language-console">$ forever stop script.js
</code></pre>

<p>Forever によって開始されたすべてのスクリプトを停止するには、次のようにします。</p>

<pre><code class="language-console">$ forever stopall
</code></pre>

<p>Forever には、さらに多くのオプションがあり、プログラマチック API もあります。</p>

<h2 id="pm2">PM2</h2>

<p>PM2 は、ロード・バランサーが組み込まれた、Node.js アプリケーション用の実動プロセス・マネージャーです。PM2 では、アプリケーションの稼働を永続的に維持して、ダウン時間を発生させずに再ロードすることができ、共通のシステム管理タスクを簡単に実行できます。PM2 では、アプリケーションのロギング、モニター、クラスタリングを管理することもできます。</p>

<p>詳細については、<a href="https://github.com/Unitech/pm2">https://github.com/Unitech/pm2</a> を参照してください。</p>

<h3 id="section-2">インストール</h3>

<pre><code class="language-console">$ [sudo] npm install pm2 -g
</code></pre>

<h3 id="section-3">基本的な使用法</h3>

<p><code>pm2</code> コマンドを使用してアプリケーションを開始する場合、アプリケーションのパスを指定する必要があります。ただし、アプリケーションの停止、再始動、または削除を行う場合は、アプリケーションの名前または ID を指定するだけで済みます。</p>

<pre><code class="language-console">$ pm2 start npm --name my-app -- start
[PM2] restartProcessId process id 0
┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐
│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │
├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤
│ my-app   │ 0  │ fork │ 64029 │ online │ 1       │ 0s     │ 17.816 MB   │ disabled │
└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘
 Use the `pm2 show &lt;id|name&gt;` command to get more details about an app.
</code></pre>

<p><code>pm2</code> コマンドを使用してアプリケーションを開始する場合、アプリケーションは即時にバックグラウンドに送信されます。さまざまな <code>pm2</code> コマンドを使用して、コマンド・ラインからバックグラウンド・アプリケーションを制御できます。</p>

<p><code>pm2</code> コマンドを使用してアプリケーションが開始された後、アプリケーションはID を使用して PM2 のプロセス・リストに登録されます。そのため、システム上の別のディレクトリーからID を使用して同じ名前を持つアプリケーションを管理できます。</p>

<p>同じ名前を持つ複数のアプリケーションが実行されている場合、<code>pm2</code> コマンドがすべてのアプリケーションに影響を与えることに注意してください。そのため、個々のアプリケーションを管理するには、名前ではなく ID を使用してください。</p>

<p>実行中のプロセスをすべてリストするには、次のようにします。</p>

<pre><code class="language-console">$ pm2 list
</code></pre>

<p>アプリケーションを停止するには、次のようにします。</p>

<pre><code class="language-console">$ pm2 stop 0
</code></pre>

<p>アプリケーションを再始動するには、次のようにします。</p>

<pre><code class="language-console">$ pm2 restart 0
</code></pre>

<p>アプリケーションに関する詳細情報を表示するには、次のようにします。</p>

<pre><code class="language-console">$ pm2 show 0
</code></pre>

<p>アプリケーションを PM2 のレジストリーから削除するには、次のようにします。</p>

<pre><code class="language-console">$ pm2 delete 0
</code></pre>

<h2 id="strongloop-process-manager">StrongLoop Process Manager</h2>

<p>StrongLoop Process Manager (StrongLoop PM) は、Node.js アプリケーション用の実動プロセス・マネージャーです。StrongLoop PM には、ロード・バランシング、モニター、マルチホスト・デプロイメント、およびグラフィカル・コンソールが組み込まれています。
StrongLoop PM は、以下のタスクに使用できます。</p>

<ul>
  <li>Node.js アプリケーションを作成してパッケージし、ローカル・システムまたはリモート・システムにデプロイする。</li>
  <li>CPU プロファイルとヒープ・スナップショットを表示して、パフォーマンスを最適化し、メモリー・リークを診断する。</li>
  <li>プロセスとクラスターの稼働を永続的に維持する。</li>
  <li>アプリケーションのパフォーマンス・メトリックを表示する。</li>
  <li>Nginx が統合されたマルチホスト・デプロイメントを容易に管理する。</li>
  <li>複数の StrongLoop PM を、Arc から管理される分散マイクロサービス・ランタイムに統合する。</li>
</ul>

<p>StrongLoop PM で作業するには、<code>slc</code> という強力なコマンド・ライン・インターフェース、または Arc というグラフィカル・ツールを使用します。Arc は、オープン・ソースであり、StrongLoop によって専門的なサポートが提供されます。</p>

<p>詳細については、<a href="http://strong-pm.io/">http://strong-pm.io/</a> を参照してください。</p>

<p>詳細な説明:</p>

<ul>
  <li><a href="http://docs.strongloop.com/display/SLC">Operating Node apps (StrongLoop 資料)</a></li>
  <li><a href="http://docs.strongloop.com/display/SLC/Using+Process+Manager">Using StrongLoop Process Manager</a>.</li>
</ul>

<h3 id="section-4">インストール</h3>
<pre><code class="language-console">$ [sudo] npm install -g strongloop
</code></pre>

<h3 id="section-5">基本的な使用法</h3>
<pre><code class="language-console">$ cd my-app
$ slc start
</code></pre>

<p>プロセス・マネージャーとすべてのデプロイ済みアプリケーションを表示するには、次のようにします。</p>

<pre><code class="language-console">$ slc ctl
Service ID: 1
Service Name: my-app
Environment variables:
  No environment variables defined
Instances:
    Version  Agent version  Cluster size
     4.1.13      1.5.14           4
Processes:
        ID      PID   WID  Listening Ports  Tracking objects?  CPU profiling?
    1.1.57692  57692   0
    1.1.57693  57693   1     0.0.0.0:3001
    1.1.57694  57694   2     0.0.0.0:3001
    1.1.57695  57695   3     0.0.0.0:3001
    1.1.57696  57696   4     0.0.0.0:3001
</code></pre>

<p>すべての管理対象アプリケーション (サービス) をリストするには、次のようにします。</p>

<pre><code class="language-console">$ slc ctl ls
Id          Name         Scale
 1          my-app       1
</code></pre>

<p>アプリケーションを停止するには、次のようにします。</p>

<pre><code class="language-console">$ slc ctl stop my-app
</code></pre>

<p>アプリケーションを再始動するには、次のようにします。</p>

<pre><code class="language-console">$ slc ctl restart my-app
</code></pre>

<p>「ソフト再始動」も実行できます。実行するとワーカー・プロセスに既存の接続をクローズするための猶予期間を与えた後で、現行のアプリケーションが再始動されます。</p>

<pre><code class="language-console">$ slc ctl soft-restart my-app
</code></pre>

<p>アプリケーションを管理対象から削除するには、次のようにします。</p>

<pre><code class="language-console">$ slc ctl remove my-app
</code></pre>
<p>## SystemD</p>

<h3 id="section-6">イントロダクション</h3>

<p>SystemDは現代のLinuxディストリビューションにおける、デフォルトのプロセスマネージャです。SystemDに基づいたノードサービスの実行は非常に簡単です。注：このセクションは、<a href="https://www.axllent.org/docs/view/nodejs-service-with-systemd/">Ralph Slooten(@axllent) のブログ記事</a>に基づいています。</p>

<h3 id="service">serviceのセットアップ</h3>

<p>Create a file in <code>/etc/systemd/system/express.service</code>:</p>

<pre><code class="language-sh">[Unit]
Description=Express
# Set dependencies to other services (optional)
#After=mongodb.service

[Service]
# Run Grunt before starting the server (optional)
#ExecStartPre=/usr/bin/grunt

# Start the js-file starting the express server
ExecStart=/usr/bin/node server.js
WorkingDirectory=/usr/local/express
Restart=always
RestartSec=10
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=Express
# Change to a non-root user (optional, but recommended)
#User=&lt;alternate user&gt;
#Group=&lt;alternate group&gt;
# Set environment options
Environment=NODE_ENV=production PORT=8080

[Install]
WantedBy=multi-user.target
</code></pre>

<h3 id="service-1">serviceの有効化</h3>

<pre><code class="language-console">$ systemctl enable express.service
</code></pre>

<h3 id="service-2">serviceの起動</h3>

<pre><code class="language-console">$ systemctl start express.service
</code></pre>

<h3 id="service-3">serviceのステータスのチェック</h3>

<pre><code class="language-console">$ systemctl status express.service
</code></pre>

      </div>
    </section>

    <a id="top" href="#"><img src="/images/arrow.png"></a>

<footer>
    <div id="footer-content">
        <div id="github">
            <iframe src="//ghbtns.com/github-btn.html?user=expressjs&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
        </div>
        <div id="sponsor"><a href="https://expressjs.com">Express</a>は、<a href="https://openjsf.org">OpenJSの財団</a>のプロジェクトです。</div>
        <div id="fork"><a href="https://github.com/expressjs/expressjs.com">GitHub で Web サイトを fork します</a>。</div>
        <div>Copyright &copy; StrongLoop, Inc.、およびその他の expressjs.com コントリビューター。</div>
    </div>
    <div id="license">
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> この 作品 は <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">クリエイティブ・コモンズ 表示 - 継承 3.0 アメリカ合衆国 ライセンスの下に提供されています。</a>
    </div>
</footer>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '7164e33055faa6ecddefd9e08fc59f5d',
  indexName: 'expressjs',
  inputSelector: '#q',
  algoliaOptions: { 'facetFilters': ['lang:ja'] }
})" async></script>



  </body>

</html>

